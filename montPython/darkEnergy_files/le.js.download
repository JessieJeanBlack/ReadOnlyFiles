/*! Copyright 2015 Logentries.
Please view license at https://raw.github.com/logentries/le_js/master/LICENSE*/
"use strict";!function(e,n){"function"==typeof define&&define.amd?define(function(){return n(e)}):"object"==typeof exports?("object"==typeof global&&(e=global),module.exports=n(e)):e.LE=n(e)}(this,function(e){function n(n){var t,r=n.trace?(Math.random()+Math.PI).toString(36).substring(2,10):null,o=n.page_info,i=n.token,a=n.print,s=n.no_format;t="undefined"==typeof XDomainRequest?n.ssl:"https:"===e.location.protocol?!0:!1;var u;u=e.LEENDPOINT?e.LEENDPOINT:s?"webhook.logentries.com/noformat":"js.logentries.com/v1",u=(t?"https://":"http://")+u+"/logs/"+i;var l=[],f=!1,c=!1;if(n.catchall){var p=e.onerror;e.onerror=function(e,n,t){return h({error:e,line:t,location:n}).level("ERROR").send(),p?p(e,n,t):!1}}var d=function(){var n=e.navigator||{doNotTrack:void 0},t=e.screen||{};return{url:(e.location||{}).pathname,referrer:document.referrer,screen:{width:t.width,height:t.height},window:{width:e.innerWidth,height:e.innerHeight},browser:{name:n.appName,version:n.appVersion,cookie_enabled:n.cookieEnabled,do_not_track:n.doNotTrack},platform:n.platform}},g=function(){var e=null,e=Array.prototype.slice.call(arguments);if(0===e.length)throw Error("No arguments!");return e=1===e.length?e[0]:e},h=function(){var e=g.apply(this,arguments),n={event:e};return"never"===o||c&&"per-entry"!==o||(c=!0,void 0===e.screen&&void 0===e.browser&&h(d()).level("PAGE").send()),r&&(n.trace=r),{level:function(e){if(a&&"undefined"!=typeof console&&"PAGE"!==e){var t=null;"undefined"!=typeof XDomainRequest&&(t=n.trace+" "+n.event);try{console[e.toLowerCase()].call(console,t||n)}catch(r){console.log(t||n)}}return n.level=e,{send:function(){var e=[],t=JSON.stringify(n,function(n,t){if(void 0===t)return"undefined";if("object"==typeof t&&null!==t){var r;e:{for(r=0;r<e.length;r++)if(t===e[r])break e;r=-1}if(-1!==r)return"<?>";e.push(t)}return t});f?l.push(t):v(i,t)}}}}};this.log=h;var v=function(e,n){f=!0;var t;t="undefined"!=typeof XDomainRequest?new XDomainRequest:new XMLHttpRequest,t.constructor===XMLHttpRequest?t.onreadystatechange=function(){4===t.readyState&&(400>t.status?(301===t.status&&console.warn("This version of le_js is deprecated! Consider upgrading."),0<l.length?v(e,l.shift()):f=!1):(console.error("Couldn't submit events."),410===t.status&&console.warn("This version of le_js is no longer supported!")))}:t.onload=function(){0<l.length?v(e,l.shift()):f=!1},t.open("POST",u,!0),t.constructor===XMLHttpRequest&&(t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Content-type","application/json")),t.overrideMimeType&&t.overrideMimeType("text"),t.send(n)}}function t(e){var t,r={ssl:!0,catchall:!1,trace:!0,page_info:"never",print:!1,endpoint:null,token:null};if("object"!=typeof e)throw Error("Invalid parameters for createLogStream()");for(var o in e)r[o]=e[o];if(null===r.token)throw Error("Token not present.");t=new n(r);var i=function(){if(t)return t.log.apply(this,arguments);throw Error("You must call LE.init(...) first.")};return{log:function(){i.apply(this,arguments).level("LOG").send()},warn:function(){i.apply(this,arguments).level("WARN").send()},error:function(){i.apply(this,arguments).level("ERROR").send()},info:function(){i.apply(this,arguments).level("INFO").send()}}}var r={},o=function(e){if("string"!=typeof e.name)throw Error("Name not present.");if(r.hasOwnProperty(e.name))throw Error("A logger with that name already exists!");return r[e.name]=new t(e),!0};return{init:function(e){var n={name:"default"};if("object"==typeof e)for(var t in e)n[t]=e[t];else{if("string"!=typeof e)throw Error("Invalid parameters for init()");n.token=e}return o(n)},createLogStream:o,to:function(e){if(!r.hasOwnProperty(e))throw Error("Invalid name for logStream");return r[e]},destroy:function(e){void 0===e&&(e="default"),delete r[e]},log:function(){for(var e in r)r[e].log.apply(this,arguments)},warn:function(){for(var e in r)r[e].warn.apply(this,arguments)},error:function(){for(var e in r)r[e].error.apply(this,arguments)},info:function(){for(var e in r)r[e].info.apply(this,arguments)}}});
